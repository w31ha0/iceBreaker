{"version":3,"file":"4.d1d99a2489398c2add31.hot-update.js","sources":["webpack:///pages/index.js"],"sourcesContent":["import React from \"react\";\r\nimport Pusher from 'pusher-js';\r\nimport User from '../models/User'\r\nimport utils from \"../utils/utils\"\r\nimport Page from '../components/Page';\r\nimport SignIn from \"../components/SignIn\"\r\nimport strings from '../constants/strings'\r\nimport {notify} from \"react-notify-toast\";\r\nimport gameUtils from \"../utils/gameUtils\"\r\nimport Layout from '../components/Layout.js'\r\nimport credentials from '../constants/credentials'\r\nimport LoadingScreen from \"../components/LoadingScreen\"\r\nimport notificationUtils from \"../utils/notificationUtils\"\r\nimport LetterComponent from '../components/LettersComponent'\r\nimport ExchangeRequest from '../components/ExchangeRequest'\r\nimport ExchangeResponse from '../components/ExchangeResponse'\r\nimport WaitingForVerification from '../components/WaitingForVerification'\r\n\r\n\r\nexport default class extends Page {\r\n\r\n    constructor(){\r\n        super()\r\n        this.state = {\r\n            userName: \"\",\r\n            activeUsers : [],\r\n            lettersAssigned: [],\r\n            userSelected: '',\r\n            isWaitingForCounterPartyToVerify: false,\r\n            isVerifyingForCounterParty: true,\r\n            isWaitingForGameToStart: false,\r\n            signedIn: true,\r\n            letterToGive: '',\r\n            authenticationChecked: false,\r\n            gameStartedChecked: false\r\n        }\r\n        console.log(\"notify from index is \"+JSON.stringify(notify))\r\n        this.exchangeRequest = {}\r\n\r\n    }\r\n\r\n    componentDidMount(){\r\n        this.setupPusher()\r\n        this.checkGameState()\r\n        /*\r\n        this.setState({\r\n            signedIn: true,\r\n            authenticationChecked: true,\r\n            gameStartedChecked: true,\r\n            isWaitingForGameToStart: false,\r\n        })*/\r\n    }\r\n\r\n    setupPusher = () => {\r\n        this.pusher = new Pusher(credentials.PUSHER_APP_KEY, {\r\n            cluster: credentials.PUSHER_APP_CLUSTER,\r\n            encrypted: true\r\n        });\r\n\r\n        this.channel = this.pusher.subscribe(strings.PUSHER_CHANNEL);\r\n\r\n        this.channel.bind(strings.PUSHER_USER_LIST_UPDATE_EVENT, (users) => {\r\n            const activeUsers = users.activeUsers\r\n            console.log(\"Received new user list from Pusher: \" + activeUsers)\r\n            var newActiveUsers = activeUsers.map(user => user.name)\r\n            this.setState({\r\n                activeUsers: newActiveUsers\r\n            })\r\n        });\r\n\r\n        this.channel.bind(strings.PUSHER_NEW_EXCHANGE_REQUEST_EVENT, (exchangeRequest) => {\r\n            console.log(\"Received new exchange request: \" + JSON.stringify(exchangeRequest))\r\n            if (exchangeRequest.respond_user == this.state.userName) {\r\n                console.log(\"Exchange request is for me.\")\r\n                this.exchangeRequest = exchangeRequest\r\n                this.setState({\r\n                    isVerifyingForCounterParty: true\r\n                })\r\n            }\r\n        });\r\n\r\n        this.channel.bind(strings.EXCHANGE_COMPLETED_EVENT, (data) => {\r\n            if (data.request_user == this.state.userName) {\r\n                notificationUtils.showNotification(strings.NOTIFICATION_EXCHANGE_SUCCESSFUL)\r\n                console.log(\"Exchange request has completed: \" + JSON.stringify(data))\r\n                console.log(\"Letters assigned are now \" + this.state.lettersAssigned)\r\n                this.setState({\r\n                    isWaitingForCounterPartyToVerify: false\r\n                })\r\n                this.retrieveAllGameInformation()\r\n            }\r\n        });\r\n\r\n        this.channel.bind(strings.PUSHER_GAME_START_EVENT, () => {\r\n            if (this.state.signedIn) {\r\n                console.log(\"Game has started...loading main page...\")\r\n                this.setState({\r\n                    isWaitingForGameToStart: false\r\n                })\r\n                this.retrieveAllGameInformation()\r\n                notificationUtils.showNotification(strings.NOTIFICATION_GAME_BEGUN)\r\n            }\r\n        });\r\n\r\n        this.channel.bind(strings.PUSHER_GAME_STOP_EVENT, () => {\r\n            if (this.state.signedIn) {\r\n                console.log(\"Received notification to stop the game abruptly!\")\r\n                localStorage.clear()\r\n                this.pusher.disconnect()\r\n                window.alert(\"Game has been forcefully stopped by game master\")\r\n                window.location.href = '/'\r\n            }\r\n        });\r\n\r\n        this.channel.bind(strings.PUSHER_EXCHANGE_CANCELLED_EVENT, (data) => {\r\n            console.log(\"Received cancel request: \"+JSON.stringify(data))\r\n            if (data.request_user == this.state.userName && this.state.isWaitingForCounterPartyToVerify) {\r\n                this.setState({\r\n                    isWaitingForCounterPartyToVerify: false\r\n                })\r\n                notificationUtils.showNotification(strings.NOTIFICATION_CANCEL_EXCHANGE)\r\n            }\r\n            else if (data.respond_user == this.state.userName && this.state.isVerifyingForCounterParty) {\r\n                this.setState({\r\n                    isVerifyingForCounterParty: false\r\n                })\r\n                notificationUtils.showNotification(strings.NOTIFICATION_CANCEL_EXCHANGE)\r\n            }\r\n        });\r\n\r\n        window.onbeforeunload = function(){\r\n            this.pusher.disconnect()\r\n        };\r\n    }\r\n\r\n    checkGameState = () => {\r\n        gameUtils.checkAuthenticated().then((res) => {\r\n            this.setState({\r\n                signedIn: true,\r\n                authenticationChecked: true,\r\n            })\r\n        },(err) => {\r\n            this.setState({\r\n                authenticationChecked: true\r\n            })\r\n        })\r\n\r\n        gameUtils.checkGameStarted().then((res) => {\r\n            this.setState({\r\n                isWaitingForGameToStart: false\r\n            })\r\n            this.retrieveAllGameInformation()\r\n            this.setState({\r\n                gameStartedChecked: true\r\n            })\r\n        },(err) => {\r\n            this.setState({\r\n                gameStartedChecked: true\r\n            })\r\n        })\r\n    }\r\n\r\n    retrieveAllGameInformation = () => {\r\n        this.retriveUserName()\r\n        this.retriveLetters()\r\n        this.retrieveActiveUsers()\r\n    }\r\n\r\n    cancelWaitingForVerification = (r) => {\r\n        this.setState({\r\n            isWaitingForCounterPartyToVerify: false\r\n        })\r\n        gameUtils.cancelExchange(this.exchangeRequest)\r\n    }\r\n\r\n    onExchangeRequestSubmitSuccess = (letterToGive,exchangeRequest) => {\r\n        utils.saveToLocalStorage(exchangeRequest.respond_user,JSON.stringify(exchangeRequest))\r\n        const userSelected = this.state.userSelected\r\n        this.setState({\r\n            isWaitingForCounterPartyToVerify: true,\r\n            letterToGive: letterToGive,\r\n            userSelected: ''\r\n        })\r\n        this.setState({\r\n            userSelected: userSelected\r\n        })\r\n    }\r\n\r\n    onExchangeResponseSubmitSuccess = (exchangeResponse) => {\r\n        notificationUtils.showNotification(strings.NOTIFICATION_EXCHANGE_SUCCESSFUL)\r\n        this.retriveLetters()\r\n        utils.saveToLocalStorage(exchangeResponse.request_user,JSON.stringify(exchangeResponse))\r\n        this.setState({\r\n            isVerifyingForCounterParty: false\r\n        })\r\n    }\r\n\r\n    onGameCompleted = () => {\r\n        this.pusher.disconnect()\r\n    }\r\n\r\n    onUserSelected = (e) => {\r\n        if(this.state.activeUsers[e.target.id] === this.state.userName)\r\n            notificationUtils.showNotification(strings.NOTIFICATION_SAME_NAME_SELECTED)\r\n        else {\r\n            console.log(\"Setting user selected to \" + e.target.id)\r\n            this.setState({\r\n                userSelected: this.state.activeUsers[e.target.id]\r\n            })\r\n        }\r\n    }\r\n\r\n    retriveLetters = () => {\r\n        gameUtils.getAssignedLetters().then((letters) => {\r\n            this.setState({\r\n                lettersAssigned : letters\r\n            })\r\n        },function(err){})\r\n    }\r\n\r\n    retrieveActiveUsers = () => {\r\n        gameUtils.getActiveUsers().then((activeUsers) => {\r\n            this.setState({\r\n                activeUsers : activeUsers\r\n            })\r\n        },function(err){})\r\n    }\r\n\r\n    retriveUserName = () => {\r\n        gameUtils.getUserName().then((userName) => {\r\n            this.setState({\r\n                userName: userName\r\n            })\r\n        },function(err){})\r\n    }\r\n\r\n    cancelRespondToRequester = () => {\r\n        this.setState({\r\n            isVerifyingForCounterParty: false\r\n        })\r\n        gameUtils.cancelExchange(this.exchangeRequest)\r\n    }\r\n\r\n    onSignIn = (name,birthday,favouriteFood,deshu) => {\r\n        name = name.toUpperCase()\r\n        console.log(\"Signing in...\"+name)\r\n        const user = new User(name,birthday,deshu,favouriteFood)\r\n        gameUtils.loginUser(user).then((succeed)=>{\r\n            this.setState({\r\n                signedIn: true\r\n            })\r\n        },function(errMessage){\r\n            notificationUtils.showNotification(errMessage)\r\n        })\r\n    }\r\n\r\n    updateExchangeRequest = (exchangeRequest) => {\r\n        this.exchangeRequest = exchangeRequest\r\n    }\r\n\r\n    render(){\r\n        if(!this.state.authenticationChecked || !this.state.gameStartedChecked)\r\n            return(\r\n                <Layout>\r\n                </Layout>\r\n            )\r\n        else if(!this.state.signedIn)\r\n            return(\r\n                <Layout>\r\n                    <div id=\"signIn\">\r\n                        <SignIn onSignIn={this.onSignIn}/>\r\n                    </div>\r\n                </Layout>\r\n            )\r\n        else if (this.state.isWaitingForGameToStart && this.state.signedIn)\r\n            return(\r\n                <Layout>\r\n                    <LoadingScreen/>\r\n                </Layout>\r\n            )\r\n        if (this.state.isWaitingForCounterPartyToVerify)\r\n            return(\r\n                <Layout>\r\n                    <WaitingForVerification cancel={this.cancelWaitingForVerification}/>\r\n                </Layout>\r\n            )\r\n        else if(this.state.isVerifyingForCounterParty)\r\n            return(\r\n                <Layout>\r\n                    <div className=\"form-group\">\r\n                        <label className=\"label-general\">{this.exchangeRequest.request_user} has requested to connect.Please fill in his details below.</label>\r\n                    </div>\r\n                    <ExchangeResponse\r\n                        targetUser={this.exchangeRequest.request_user}\r\n                        userName={this.exchangeRequest.request_user}\r\n                        onExchangeResponseSubmitSuccess={this.onExchangeResponseSubmitSuccess}\r\n                        lettersAvailable={this.state.lettersAssigned}\r\n                        exchangeRequest={this.exchangeRequest}/>\r\n                    <button onClick={this.cancelRespondToRequester} className=\"btn-cancel\">Cancel</button>\r\n                </Layout>\r\n            )\r\n        else\r\n            return(\r\n                <Layout>\r\n                    <div id=\"wrapper\">\r\n                        <div id=\"sidebar-wrapper\">\r\n                            <nav id=\"spy\">\r\n                                <ul className=\"sidebar-nav nav\">\r\n                                    {this.state.activeUsers.map((user,index) => {\r\n                                        return <li id={index} className=\"sidebar-brand\" onClick={this.onUserSelected}>{user}</li>\r\n                                    })}\r\n                                </ul>\r\n                            </nav>\r\n                        </div>\r\n                        <div id=\"page-content-wrapper\">\r\n                            <div className=\"page-content inset\" data-spy=\"scroll\" data-target=\"#spy\">\r\n                                <LetterComponent onGameCompleted={this.onGameCompleted} userName={this.state.userName} lettersAssigned={this.state.lettersAssigned}/>\r\n                                <div style={{marginTop:'50px',marginBottom:'50px'}} className=\"form-group\">\r\n                                    <label className=\"label-general\">Fill in the details of the player you would like to exchange with below.</label>\r\n                                </div>\r\n                                <ExchangeRequest\r\n                                    targetUser={this.state.userSelected}\r\n                                    userName={this.state.userName}\r\n                                    onExchangeRequestSubmitSuccess={this.onExchangeRequestSubmitSuccess}\r\n                                    userSelected={this.state.userSelected}\r\n                                    lettersAvailable={this.state.lettersAssigned}\r\n                                    updateExchangeRequest={this.updateExchangeRequest}/>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <style jsx>{`\r\n                    #signIn {\r\n                        background-color: black\r\n                       }\r\n                    #wrapper.active {\r\n                      padding-left: 0;\r\n                    }\r\n                    #wrapper.active #sidebar-wrapper {\r\n                      left: 0;\r\n                    }\r\n                    #page-content-wrapper {\r\n                      width: 100%;\r\n                    }\r\n                    .sidebar-nav li {\r\n                      line-height: 40px;\r\n                      text-indent: 20px;\r\n                    }\r\n                    .sidebar-nav li a {\r\n                      color: #999999;\r\n                      display: block;\r\n                      text-decoration: none;\r\n                      padding-left: 60px;\r\n                    }\r\n                    .sidebar-nav li a span:before {\r\n                      position: absolute;\r\n                      left: 0;\r\n                      color: #41484c;\r\n                      text-align: center;\r\n                      width: 20px;\r\n                      line-height: 18px;\r\n                    }\r\n                    .sidebar-nav li a:hover,\r\n                    .sidebar-nav li.active {\r\n                      color: #fff;\r\n                      background: rgba(255,255,255,0.2);\r\n                      text-decoration: none;\r\n                    }\r\n                    .sidebar-nav li a:active,\r\n                    .sidebar-nav li a:focus {\r\n                      text-decoration: none;\r\n                    }\r\n                    .sidebar-nav > .sidebar-brand a {\r\n                      color: #999999;\r\n                    }\r\n                    .sidebar-nav > .sidebar-brand a:hover {\r\n                      color: #fff;\r\n                      background: none;\r\n                    }\r\n                    .inset {\r\n                      padding: 20px;\r\n                    }\r\n\r\n                    @media (min-width:1224px) {\r\n                        #wrapper {\r\n                          padding-left: 250px;\r\n                          transition: all 0.4s ease 0s;\r\n                        }\r\n                        #sidebar-wrapper {\r\n                          margin-left: -250px;\r\n                          left: 250px;\r\n                          width: 250px;\r\n                          background: linear-gradient(#000000, #3300CC);\r\n                          font-family: 'Roboto Medium', sans-serif;\r\n                          font-size: 100%;\r\n                          font-weight: lighter;\r\n                          position: fixed;\r\n                          height: 100%;\r\n                          overflow-y: auto;\r\n                          z-index: 1000;\r\n                          transition: all 0.4s ease 0s;\r\n                          color: white;\r\n                        }\r\n\r\n                        .sidebar-nav > .sidebar-brand {\r\n                          height: 65px;\r\n                          line-height: 60px;\r\n                          font-size: 18px;\r\n                        }\r\n\r\n                        .sidebar-nav {\r\n                          position: absolute;\r\n                          top: 0;\r\n                          width: 250px;\r\n                          list-style: none;\r\n                          margin: 0;\r\n                          padding: 0;\r\n                        }\r\n\r\n                    }\r\n\r\n                    @media (max-width:1224px) {\r\n                        #wrapper {\r\n                          padding-left: 100px;\r\n                          transition: all 0.4s ease 0s;\r\n                        }\r\n                        #sidebar-wrapper {\r\n                          margin-left: -100px;\r\n                          left: 100px;\r\n                          width: 100px;\r\n                          background: linear-gradient(#000000, #3300CC);\r\n                          font-family: 'Roboto Medium', sans-serif;\r\n                          font-size: 100%;\r\n                          font-weight: lighter;\r\n                          position: fixed;\r\n                          height: 100%;\r\n                          overflow-y: auto;\r\n                          z-index: 1000;\r\n                          transition: all 0.4s ease 0s;\r\n                          color: white;\r\n                        }\r\n\r\n                        .sidebar-nav > .sidebar-brand {\r\n                          height: 65px;\r\n                          line-height: 60px;\r\n                          font-size: 10px;\r\n                        }\r\n\r\n                        .sidebar-nav {\r\n                          position: absolute;\r\n                          top: 0;\r\n                          width: 100px;\r\n                          list-style: none;\r\n                          margin: 0;\r\n                          padding: 0;\r\n                        }\r\n\r\n                    }\r\n*{ border:2px solid #CD1821 }\r\n                    `}</style>\r\n                </Layout>\r\n            )\r\n    }\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// pages/index.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAIA;AAAA;AACA;AADA;AACA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAiCA;AACA;AACA;AAFA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AACA;AAEA;AACA;AAEA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmHA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AADA;AAGA;AAEA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AADA;AAGA;AACA;AA3IA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8IA;AACA;AAAA;AACA;AAAA;AACA;AAjJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoJA;AACA;AADA;AACA;AAEA;AACA;AAxJA;AAAA;AAAA;AAAA;AAAA;AAAA;AA2JA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AACA;AAIA;AACA;AADA;AAGA;AArKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwKA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AADA;AAGA;AA9KA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiLA;AACA;AAlLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqLA;AAGA;AACA;AAAA;AACA;AADA;AAGA;AACA;AA7LA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgMA;AACA;AACA;AADA;AAGA;AACA;AArMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwMA;AACA;AACA;AADA;AAGA;AACA;AA7MA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgNA;AACA;AACA;AADA;AAGA;AACA;AArNA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwNA;AACA;AADA;AACA;AAEA;AACA;AA5NA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+NA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAzOA;AAAA;AAAA;AAAA;AAAA;AAAA;AA4OA;AACA;AA7OA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAaA;AACA;AAhBA;AAkBA;AACA;;;AACA;AACA;AACA;AACA;;;;;;;AAOA;;;AAiNA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAjBA;AAAA;AAAA;AA8JA;;;;AA1bA;AACA;;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}