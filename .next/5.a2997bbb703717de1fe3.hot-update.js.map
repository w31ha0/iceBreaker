{"version":3,"file":"5.a2997bbb703717de1fe3.hot-update.js","sources":["webpack:///pages/index.js"],"sourcesContent":["import axios from 'axios'\r\nimport React from \"react\";\r\nimport Pusher from 'pusher-js';\r\nimport Page from '../components/Page';\r\nimport strings from '../constants/strings'\r\nimport Layout from '../components/Layout.js'\r\nimport endpoints from '../constants/endpoints'\r\nimport credentials from '../constants/credentials'\r\nimport LetterComponent from '../components/LettersComponent'\r\nimport ExchangeRequest from '../components/ExchangeRequest'\r\nimport ExchangeResponse from '../components/ExchangeResponse'\r\nimport WaitingForVerification from '../components/WaitingForVerification'\r\nimport LoadingScreen from \"../components/LoadingScreen\"\r\nimport SignIn from \"../components/SignIn\"\r\nimport utils from \"../utils/utils\"\r\n\r\nexport default class extends Page {\r\n\r\n    constructor(){\r\n        super()\r\n        this.state = {\r\n            userName: \"\",\r\n            activeUsers : [],\r\n            lettersAssigned: [],\r\n            userSelected: '',\r\n            isWaitingForCounterPartyToVerify: false,\r\n            isVerifyingForCounterParty: false,\r\n            isWaitingForGameToStart: true,\r\n            signedIn: false,\r\n            letterToGive: ''\r\n        }\r\n        this.exchangeRequest = {}\r\n\r\n    }\r\n\r\n    componentDidUpdate(){\r\n\r\n    }\r\n\r\n    componentWillMount(){\r\n        //check if authenticated\r\n        axios({\r\n            method: 'post',\r\n            url: endpoints.API_CHECK_AUTHENTICATED\r\n        })\r\n        .then((response) => {\r\n            if(response.data.result == 1)\r\n                this.setState({\r\n                    signedIn: true\r\n                })\r\n        })\r\n        .catch(function (response) {\r\n            console.log(response);\r\n        });\r\n\r\n        //check if game has already started\r\n        axios({\r\n            method: 'post',\r\n            url: endpoints.API_CHECK_GAME_STARTED\r\n        })\r\n        .then((response) => {\r\n            if(response.data.result == 1)\r\n                this.setState({\r\n                    isWaitingForGameToStart: false\r\n                })\r\n                console.log(\"Going to retrive all information\")\r\n                this.retriveUserName()\r\n                this.retriveLetters()\r\n                this.retrieveActiveUsers()\r\n        })\r\n        .catch(function (response) {\r\n            console.log(response);\r\n        });\r\n    }\r\n\r\n    async componentDidMount(){\r\n        this.pusher = new Pusher(credentials.PUSHER_APP_KEY, {\r\n            cluster: credentials.PUSHER_APP_CLUSTER,\r\n            encrypted: true\r\n        });\r\n\r\n        this.channel = this.pusher.subscribe(strings.PUSHER_CHANNEL);\r\n\r\n        this.channel.bind(strings.PUSHER_USER_LIST_UPDATE_EVENT, (users) => {\r\n            console.log(\"Received new user list from Pusher: \"+users)\r\n            var newActiveUsers = users.map(user => user.name)\r\n            this.setState({\r\n                activeUsers: newActiveUsers\r\n            })\r\n        });\r\n\r\n        this.channel.bind(strings.PUSHER_NEW_EXCHANGE_REQUEST_EVENT, (exchangeRequest) => {\r\n            console.log(\"Received new exchange request: \"+JSON.stringify(exchangeRequest))\r\n            if(exchangeRequest.respond_user == this.state.userName){\r\n                console.log(\"Exchange request is for me.\")\r\n                this.exchangeRequest = exchangeRequest\r\n                this.setState({\r\n                    isVerifyingForCounterParty: true\r\n                })\r\n            }\r\n        });\r\n\r\n        this.channel.bind(strings.EXCHANGE_COMPLETED_EVENT, (data) => {\r\n            if(data.request_user == this.state.userName){\r\n                console.log(\"Exchange request has completed: \"+JSON.stringify(data))\r\n                console.log(\"Letters assigned are now \"+this.state.lettersAssigned)\r\n                this.setState({\r\n                    isWaitingForCounterPartyToVerify: false\r\n                })\r\n                this.retriveLetters()\r\n            }\r\n        });\r\n\r\n        this.channel.bind(strings.PUSHER_GAME_START_EVENT, () => {\r\n            console.log(\"Game has started...loading main page...\")\r\n            this.setState({\r\n                isWaitingForGameToStart: false\r\n            })\r\n        });\r\n\r\n    }\r\n\r\n    cancelWaitingForVerification = (r) => {\r\n        this.setState({\r\n            isWaitingForCounterPartyToVerify: false\r\n        })\r\n    }\r\n\r\n    onExchangeRequestSubmitSuccess = (letterToGive) => {\r\n        this.setState({\r\n            isWaitingForCounterPartyToVerify: true,\r\n            letterToGive: letterToGive\r\n        })\r\n    }\r\n\r\n    onExchangeResponseSubmitSuccess = () => {\r\n        this.setState({\r\n            isVerifyingForCounterParty: false\r\n        })\r\n        this.retriveLetters()\r\n    }\r\n\r\n    onClick = (e) => {\r\n        console.log(\"Setting user selected to \"+e.target.id)\r\n        this.setState({\r\n            userSelected: this.state.activeUsers[e.target.id]\r\n        })\r\n    }\r\n\r\n    retriveLetters = () => {\r\n        axios({\r\n            method: 'post',\r\n            url: endpoints.API_GET_ASSIGNED_LETTERS\r\n        })\r\n        .then((response) => {\r\n            console.log('Got letters assigned as '+response.data)\r\n            this.setState({\r\n                lettersAssigned : response.data\r\n            })\r\n        })\r\n        .catch(function (response) {\r\n            //handle error\r\n            console.log(response);\r\n        });\r\n    }\r\n\r\n    retrieveActiveUsers = () => {\r\n        axios({\r\n            method: 'post',\r\n            url: endpoints.API_GET_ALL_ACTIVE_USERS\r\n        })\r\n        .then((response) => {\r\n            const activeUsers = response.data.map(session => session.user.name)\r\n            console.log('Parsed active users as '+activeUsers)\r\n            this.setState({\r\n                activeUsers : activeUsers\r\n            })\r\n        })\r\n        .catch(function (response) {\r\n            //handle error\r\n            console.log(response);\r\n        });\r\n    }\r\n\r\n    retriveUserName = () => {\r\n        axios({\r\n            method: 'post',\r\n            url: endpoints.API_GET_SESSION\r\n        })\r\n        .then((response) => {\r\n            if (typeof response.data.user === 'undefined')\r\n                return\r\n            console.log('Received username as  '+response.data.user.name)\r\n            this.setState({\r\n                userName : response.data.user.name\r\n            })\r\n        })\r\n        .catch(function (response) {\r\n            //handle error\r\n            console.log(response);\r\n        });\r\n    }\r\n\r\n    onLetterSelected = () => {\r\n        console.log(\"Letters assigned are now \"+this.state.lettersAssigned)\r\n    }\r\n\r\n    onSignIn = (name,birthday,favouriteFood) => {\r\n        console.log(\"Signing in...\"+name)\r\n        axios({\r\n            method: 'post',\r\n            url: endpoints.API_LOGIN_USER,\r\n            data: {name: name,birthday: birthday,favouriteFood: favouriteFood}\r\n        })\r\n        .then((response) => {\r\n            if(response.data.result == 1)\r\n                this.setState({\r\n                    signedIn: true\r\n                })\r\n                console.log(\"Signed in successful\")\r\n        })\r\n        .catch(function (response) {\r\n            //handle error\r\n            console.log(response);\r\n        });\r\n    }\r\n\r\n    render(){\r\n        if(!this.state.signedIn)\r\n            return(\r\n                <Layout>\r\n                    <SignIn onSignIn={this.onSignIn}/>\r\n                </Layout>\r\n            )\r\n        else if (this.state.isWaitingForGameToStart && this.state.signedIn)\r\n            return(\r\n                <Layout>\r\n                    <LoadingScreen/>\r\n                </Layout>\r\n            )\r\n        if (this.state.isWaitingForCounterPartyToVerify)\r\n            return(\r\n                <Layout>\r\n                    <WaitingForVerification cancel={this.cancelWaitingForVerification}/>\r\n                </Layout>\r\n            )\r\n        else if(this.state.isVerifyingForCounterParty)\r\n            return(\r\n                <Layout>\r\n                    <div className=\"form-group\">\r\n                        <label>{this.exchangeRequest.request_user} has requested to connect.Please fill in his details below.</label>\r\n                    </div>\r\n                    <ExchangeResponse targetUser={this.exchangeRequest.request_user} userName={this.exchangeRequest.request_user} onExchangeResponseSubmitSuccess={this.onExchangeResponseSubmitSuccess} lettersAvailable={this.state.lettersAssigned} exchangeRequest={this.exchangeRequest}/>\r\n                </Layout>\r\n            )\r\n        else\r\n            return(\r\n                <Layout>\r\n                    <div id=\"wrapper\">\r\n                        <div id=\"sidebar-wrapper\">\r\n                            <nav id=\"spy\">\r\n                                <ul className=\"sidebar-nav nav\">\r\n                                    {this.state.activeUsers.map((user,index) => {\r\n                                        return <li id={index} className=\"sidebar-brand\" onClick={this.onClick}>{user}</li>\r\n                                    })}\r\n                                </ul>\r\n                            </nav>\r\n                        </div>\r\n                        <div id=\"page-content-wrapper\">\r\n                            <div className=\"page-content inset\" data-spy=\"scroll\" data-target=\"#spy\">\r\n                                <LetterComponent onLetterSelected={this.onLetterSelected} userName={this.state.userName} lettersAssigned={this.state.lettersAssigned}/>\r\n                                <div style={{marginTop:'50px',marginBottom:'50px'}} className=\"form-group\">\r\n                                    <label>Fill in the details of the player you would like to exchange with.</label>\r\n                                </div>\r\n                                <ExchangeRequest targetUser={this.state.userSelected} userName={this.state.userName} onExchangeRequestSubmitSuccess={this.onExchangeRequestSubmitSuccess} userSelected={this.state.userSelected} lettersAvailable={this.state.lettersAssigned}/>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <style jsx>{`\r\n                      #wrapper {\r\n                      padding-left: 250px;\r\n                      transition: all 0.4s ease 0s;\r\n                    }\r\n\r\n                    #sidebar-wrapper {\r\n                      margin-left: -250px;\r\n                      left: 250px;\r\n                      width: 250px;\r\n                      background: #000;\r\n                      position: fixed;\r\n                      height: 100%;\r\n                      overflow-y: auto;\r\n                      z-index: 1000;\r\n                      transition: all 0.4s ease 0s;\r\n                      color: white;\r\n                    }\r\n\r\n                    #wrapper.active {\r\n                      padding-left: 0;\r\n                    }\r\n\r\n                    #wrapper.active #sidebar-wrapper {\r\n                      left: 0;\r\n                    }\r\n\r\n                    #page-content-wrapper {\r\n                      width: 100%;\r\n                    }\r\n\r\n                    .sidebar-nav {\r\n                      position: absolute;\r\n                      top: 0;\r\n                      width: 250px;\r\n                      list-style: none;\r\n                      margin: 0;\r\n                      padding: 0;\r\n                    }\r\n\r\n                    .sidebar-nav li {\r\n                      line-height: 40px;\r\n                      text-indent: 20px;\r\n                    }\r\n\r\n                    .sidebar-nav li a {\r\n                      color: #999999;\r\n                      display: block;\r\n                      text-decoration: none;\r\n                      padding-left: 60px;\r\n                    }\r\n\r\n                    .sidebar-nav li a span:before {\r\n                      position: absolute;\r\n                      left: 0;\r\n                      color: #41484c;\r\n                      text-align: center;\r\n                      width: 20px;\r\n                      line-height: 18px;\r\n                    }\r\n\r\n                    .sidebar-nav li a:hover,\r\n                    .sidebar-nav li.active {\r\n                      color: #fff;\r\n                      background: rgba(255,255,255,0.2);\r\n                      text-decoration: none;\r\n                    }\r\n\r\n                    .sidebar-nav li a:active,\r\n                    .sidebar-nav li a:focus {\r\n                      text-decoration: none;\r\n                    }\r\n\r\n                    .sidebar-nav > .sidebar-brand {\r\n                      height: 65px;\r\n                      line-height: 60px;\r\n                      font-size: 18px;\r\n                    }\r\n\r\n                    .sidebar-nav > .sidebar-brand a {\r\n                      color: #999999;\r\n                    }\r\n\r\n                    .sidebar-nav > .sidebar-brand a:hover {\r\n                      color: #fff;\r\n                      background: none;\r\n                    }\r\n\r\n                    .inset {\r\n                      padding: 20px;\r\n                    }\r\n\r\n                    @media (max-width:767px) {\r\n\r\n                    #wrapper {\r\n                      padding-left: 0;\r\n                    }\r\n\r\n                    #sidebar-wrapper {\r\n                      left: 0;\r\n                    }\r\n\r\n                    #wrapper.active {\r\n                      position: relative;\r\n                      left: 250px;\r\n                    }\r\n\r\n                    #wrapper.active #sidebar-wrapper {\r\n                      left: 250px;\r\n                      width: 250px;\r\n                      transition: all 0.4s ease 0s;\r\n                    }\r\n\r\n                    #menu-toggle {\r\n                      display: inline-block;\r\n                    }\r\n\r\n                    .inset {\r\n                      padding: 15px;\r\n                    }\r\n\r\n                    }\r\n                    `}</style>\r\n                </Layout>\r\n            )\r\n    }\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// pages/index.js"],"mappings":"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","sourceRoot":""}